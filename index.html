<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ดึง LINE User ID</title>
</head>
<body>
  <h2>กำลังตรวจสอบข้อมูลผู้ใช้งาน...</h2>
  <script>
    const redirectUrl = new URLSearchParams(window.location.search).get('redirect') || '/';
    liff.init({ liffId: "2007625708-loPNM698" }).then(() => {
      if (!liff.isLoggedIn()) {
        liff.login({ redirectUri: location.href });
      } else {
        liff.getProfile().then(profile => {
          const userId = liff.getContext().userId;
          const userName = encodeURIComponent(profile.displayName);
          const finalRedirect = `${redirectUrl}?userId=${userId}&userName=${userName}`;
          location.href = finalRedirect;
        });
      }
    }).catch(err => {
      document.body.innerHTML = "<p>เกิดข้อผิดพลาดในการโหลด LIFF</p><pre>" + err + "</pre>";
    });
  </script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</body>
</html>
